<tal:sums-macro metal:define-macro="SumsMacro">
    <tal:sums tal:define="sums python:here.getColumnSums();"
              tal:condition="python:test(len(sums)>0)"> 
        <tr><th>Total</th>
            <tal:column repeat="column python:here.getColumns()">
            <th tal:condition="not: column/HiddenColumn|nothing">
                <tal:sum condition="python:test(column.id in sums)"
                         content="python:sums[column.id]">sum</tal:sum>
            </th>
            </tal:column>
        </tr>
    </tal:sums>
</tal:sums-macro>
<!-- hasDynamicHidewhen; form_method -->
<tal:hidewhenjs-macro metal:define-macro="HideWhenMacro">
        <script type="text/javascript" tal:condition="hasDynamicHidewhen" 
        tal:content="string:
function refreshHidewhen() {
    var onsuccess = function(data, textStatus, xhr) {
        for (var hw in data)
            jQuery('.hidewhen-' + hw).css('display', data[hw]?'none':'block');
    }
    jQuery.ajax({
        type: '${form_method}',
        url: 'computehidewhens',
        data: jQuery('#plomino_form').serialize(),
        success: onsuccess,
        dataType: 'json' 
    });
}
jQuery(document).ready( function() {
    jQuery('#plomino_form :input').change(refreshHidewhen);
});
    ">
    </script>
</tal:hidewhenjs-macro>
